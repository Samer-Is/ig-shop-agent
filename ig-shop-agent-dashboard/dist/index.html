<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaBot AI - Instagram Shop Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Home, BrainCircuit, ShoppingBag, ListOrdered, Bot, Plus, Edit, Trash2, Save, RefreshCw } = lucide;

        // API Configuration
        const API_URL = 'https://igshop-dev-functions-v2.azurewebsites.net/api';

        // Sidebar Component
        const Sidebar = ({ activeView, setActiveView }) => {
          const navItems = [
            { name: 'Dashboard', icon: Home },
            { name: 'Knowledge Base', icon: BrainCircuit },
            { name: 'Products', icon: ShoppingBag },
            { name: 'Orders', icon: ListOrdered },
          ];

          return (
            <aside className="w-16 sm:w-64 bg-gray-800 p-2 sm:p-4 flex flex-col">
              <div className="flex items-center justify-center sm:justify-start mb-10">
                <Bot className="h-8 w-8 text-cyan-400" />
                <h1 className="hidden sm:block text-2xl font-bold ml-2 text-white">InstaBot AI</h1>
              </div>
              <nav className="flex flex-col space-y-2">
                {navItems.map((item) => (
                  <button
                    key={item.name}
                    onClick={() => setActiveView(item.name)}
                    className={`flex items-center p-3 rounded-lg transition-colors duration-200 ${
                      activeView === item.name
                        ? 'bg-cyan-500 text-white'
                        : 'hover:bg-gray-700 text-gray-300'
                    }`}
                  >
                    <item.icon className="h-5 w-5 flex-shrink-0" />
                    <span className="hidden sm:block ml-4 font-medium">{item.name}</span>
                  </button>
                ))}
              </nav>
            </aside>
          );
        };

        // Dashboard View Component
        const DashboardView = ({ isConnected, connectToInstagram, loading, onRefresh }) => {
          return (
            <div>
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-3xl font-bold text-white">Dashboard</h2>
                <button 
                  onClick={onRefresh}
                  className="flex items-center px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors"
                >
                  <RefreshCw className="h-4 w-4 mr-2" />
                  Refresh
                </button>
              </div>
              <div className="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h3 className="text-xl font-semibold mb-4">Welcome, Shop Owner!</h3>
                <p className="text-gray-400 mb-6">
                  This is your control center. Connect your Instagram account to get started.
                </p>
                <div className="flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                  <button 
                    onClick={connectToInstagram}
                    disabled={loading}
                    className={`${loading ? 'bg-gray-600' : 'bg-green-600 hover:bg-green-700'} text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 shadow-md flex items-center`}
                  >
                    {loading && <RefreshCw className="h-4 w-4 mr-2 animate-spin" />}
                    {loading ? 'Connecting...' : 'Connect to Instagram'}
                  </button>
                  <div className="flex items-center">
                    <span className="mr-3 text-gray-300">Backend Status:</span>
                    <span className={`font-semibold ${isConnected ? 'text-green-500' : 'text-red-500'}`}>
                      {isConnected ? 'Connected ✅' : 'Disconnected ❌'}
                    </span>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        // Knowledge Base View Component
        const KnowledgeBaseView = ({ knowledgeBase, setKnowledgeBase, onSave }) => {
          return (
            <div>
              <h2 className="text-3xl font-bold mb-6 text-white">Knowledge Base</h2>
              <div className="bg-gray-800 p-6 rounded-lg shadow-lg">
                <h3 className="text-xl font-semibold mb-4">Teach Your AI</h3>
                <p className="text-gray-400 mb-6">
                  Provide all the necessary information about your business below. The AI will use this to answer customer questions about working hours, return policies, shipping info, etc.
                </p>
                <textarea
                  value={knowledgeBase}
                  onChange={(e) => setKnowledgeBase(e.target.value)}
                  className="w-full h-64 p-4 bg-gray-900 border border-gray-700 rounded-lg text-gray-300 focus:outline-none focus:ring-2 focus:ring-cyan-500"
                  placeholder="e.g., Our working hours are from 9 AM to 5 PM, Sunday to Thursday. We offer a 14-day return policy..."
                ></textarea>
                <button 
                  onClick={onSave}
                  className="mt-4 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 shadow-md flex items-center"
                >
                  <Save className="h-4 w-4 mr-2" />
                  Save Information
                </button>
              </div>
            </div>
          );
        };

        // Products View Component
        const ProductsView = ({ products, onAdd, onEdit, onDelete }) => {
          return (
            <div>
              <h2 className="text-3xl font-bold mb-6 text-white">Product Catalog</h2>
              <div className="flex justify-end mb-4">
                <button 
                  onClick={onAdd}
                  className="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 shadow-md flex items-center"
                >
                  <Plus className="h-4 w-4 mr-2" />
                  Add New Product
                </button>
              </div>
              <div className="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                <table className="w-full text-left">
                  <thead>
                    <tr className="bg-gray-700">
                      <th className="p-4 font-semibold">Product Name</th>
                      <th className="p-4 font-semibold">Price</th>
                      <th className="p-4 font-semibold">Stock</th>
                      <th className="p-4 font-semibold text-right">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {products.length > 0 ? products.map((product) => (
                      <tr key={product.id} className="border-b border-gray-700 last:border-b-0">
                        <td className="p-4">
                          <div>
                            <div className="font-medium">{product.name}</div>
                            {product.name_en && (
                              <div className="text-sm text-gray-400">{product.name_en}</div>
                            )}
                          </div>
                        </td>
                        <td className="p-4">{product.price} {product.currency}</td>
                        <td className="p-4">{product.quantity || product.stock || 0}</td>
                        <td className="p-4 flex justify-end space-x-2">
                          <button 
                            onClick={() => onEdit(product)}
                            className="bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-bold py-1 px-3 rounded-md transition-colors duration-200 flex items-center"
                          >
                            <Edit className="h-3 w-3 mr-1" />
                            Edit
                          </button>
                          <button 
                            onClick={() => onDelete(product)}
                            className="bg-red-600 hover:bg-red-700 text-white text-sm font-bold py-1 px-3 rounded-md transition-colors duration-200 flex items-center"
                          >
                            <Trash2 className="h-3 w-3 mr-1" />
                            Delete
                          </button>
                        </td>
                      </tr>
                    )) : (
                      <tr>
                        <td colSpan="4" className="p-8 text-center text-gray-400">
                          No products available. Add your first product!
                        </td>
                      </tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          );
        };

        // Orders View Component
        const OrdersView = ({ orders }) => {
          return (
            <div>
              <h2 className="text-3xl font-bold mb-6 text-white">Orders</h2>
              <div className="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                <table className="w-full text-left">
                  <thead>
                    <tr className="bg-gray-700">
                      <th className="p-4 font-semibold">Customer</th>
                      <th className="p-4 font-semibold">Product</th>
                      <th className="p-4 font-semibold">Date</th>
                      <th className="p-4 font-semibold">Status</th>
                    </tr>
                  </thead>
                  <tbody>
                    {orders.length > 0 ? orders.map((order) => (
                      <tr key={order.id} className="border-b border-gray-700 last:border-b-0">
                        <td className="p-4">{order.customer}</td>
                        <td className="p-4">{order.product}</td>
                        <td className="p-4">{order.date}</td>
                        <td className="p-4">
                          <span className={`px-2 py-1 text-xs font-semibold rounded-full ${
                            order.status === 'Shipped' ? 'bg-green-500 text-green-900' : 'bg-yellow-500 text-yellow-900'
                          }`}>
                            {order.status}
                          </span>
                        </td>
                      </tr>
                    )) : (
                      <tr>
                        <td colSpan="4" className="p-8 text-center text-gray-400">
                          No orders yet. Orders will appear here when customers make purchases.
                        </td>
                      </tr>
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          );
        };

        // Main App Component
        function App() {
          const [activeView, setActiveView] = useState('Dashboard');
          const [isConnected, setIsConnected] = useState(false);
          const [products, setProducts] = useState([]);
          const [orders, setOrders] = useState([]);
          const [knowledgeBase, setKnowledgeBase] = useState('');
          const [loading, setLoading] = useState(false);

          // Load data on startup
          useEffect(() => {
            checkBackendConnection();
            loadProducts();
            loadOrders(); 
          }, []);

          const checkBackendConnection = async () => {
            try {
              const response = await fetch(`${API_URL}/health`);
              if (response.ok) {
                setIsConnected(true);
              } else {
                setIsConnected(false);
              }
            } catch (error) {
              setIsConnected(false);
            }
          };

          const loadProducts = async () => {
            try {
              const response = await fetch(`${API_URL}/catalog`);
              if (response.ok) {
                const data = await response.json();
                setProducts(data.products || []);
              }
            } catch (error) {
              console.log('Failed to load products');
            }
          };

          const loadOrders = async () => {
            // Load sample orders for now
            setOrders([
              { id: 1, customer: 'lama.k', product: 'قميص أبيض', date: '2024-07-28', status: 'Shipped' },
              { id: 2, customer: 'ahmad_saleh', product: 'بنطال جينز', date: '2024-07-27', status: 'Pending' },
            ]);
          };

          const connectToInstagram = async () => {
            setLoading(true);
            
            try {
              // Simulate Instagram connection
              await new Promise(resolve => setTimeout(resolve, 2000));
              alert('Instagram connection feature coming soon! Backend integration ready.');
            } catch (error) {
              alert('Instagram connection failed');
            } finally {
              setLoading(false);
            }
          };

          const addProduct = async () => {
            const name = prompt('Product name:');
            const nameEn = prompt('Product name (English):');
            const price = prompt('Product price (JOD):');
            const stock = prompt('Stock quantity:');
            
            if (name && price && stock) {
              const newProduct = {
                id: 'prod_' + Date.now(),
                name,
                name_en: nameEn,
                price: parseFloat(price),
                currency: 'JOD',
                quantity: parseInt(stock),
                stock: parseInt(stock)
              };
              
              setProducts([...products, newProduct]);
              alert('Product added successfully!');
            }
          };

          const editProduct = async (product) => {
            const name = prompt('Product name:', product.name);
            const price = prompt('Product price (JOD):', product.price);
            const stock = prompt('Stock quantity:', product.quantity || product.stock);
            
            if (name && price && stock) {
              const updatedProducts = products.map(p => 
                p.id === product.id 
                  ? { ...p, name, price: parseFloat(price), quantity: parseInt(stock), stock: parseInt(stock) }
                  : p
              );
              setProducts(updatedProducts);
              alert('Product updated successfully!');
            }
          };

          const deleteProduct = async (product) => {
            if (confirm(`Delete ${product.name}?`)) {
              const updatedProducts = products.filter(p => p.id !== product.id);
              setProducts(updatedProducts);
              alert('Product deleted successfully!');
            }
          };

          const saveKnowledgeBase = async () => {
            alert('Knowledge base saved successfully!');
          };

          const renderView = () => {
            switch (activeView) {
              case 'Dashboard':
                return <DashboardView 
                  isConnected={isConnected} 
                  connectToInstagram={connectToInstagram}
                  loading={loading}
                  onRefresh={checkBackendConnection}
                />;
              case 'Knowledge Base':
                return <KnowledgeBaseView 
                  knowledgeBase={knowledgeBase}
                  setKnowledgeBase={setKnowledgeBase}
                  onSave={saveKnowledgeBase}
                />;
              case 'Products':
                return <ProductsView 
                  products={products}
                  onAdd={addProduct}
                  onEdit={editProduct}
                  onDelete={deleteProduct}
                />;
              case 'Orders':
                return <OrdersView orders={orders} />;
              default:
                return <DashboardView 
                  isConnected={isConnected} 
                  connectToInstagram={connectToInstagram}
                  loading={loading}
                  onRefresh={checkBackendConnection}
                />;
            }
          };

          return (
            <div className="min-h-screen bg-gray-900 text-white font-sans flex">
              <Sidebar activeView={activeView} setActiveView={setActiveView} />
              <main className="flex-1 p-4 sm:p-6 lg:p-8">
                {renderView()}
              </main>
            </div>
          );
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html> 