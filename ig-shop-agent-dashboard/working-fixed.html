<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaBot AI - Instagram Shop Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Home, BrainCircuit, ShoppingBag, ListOrdered, Bot, Plus, Edit, Trash2, Save, RefreshCw } = lucide;

        const API_URL = 'https://igshop-dev-functions-v2.azurewebsites.net/api';

        function App() {
            const [activeView, setActiveView] = useState('Dashboard');
            const [isConnected, setIsConnected] = useState(false);
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [knowledgeBase, setKnowledgeBase] = useState('');
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                checkBackendConnection();
                loadProducts();
                loadOrders();
            }, []);

            const checkBackendConnection = async () => {
                try {
                    const response = await fetch(`${API_URL}/health`);
                    setIsConnected(response.ok);
                } catch (error) {
                    setIsConnected(false);
                }
            };

            const loadProducts = async () => {
                try {
                    const response = await fetch(`${API_URL}/catalog`);
                    if (response.ok) {
                        const data = await response.json();
                        setProducts(data.products || []);
                    }
                } catch (error) {
                    console.log('Failed to load products');
                }
            };

            const loadOrders = () => {
                setOrders([
                    { id: 1, customer: 'lama.k', product: 'قميص أبيض', date: '2024-07-28', status: 'Shipped' },
                    { id: 2, customer: 'ahmad_saleh', product: 'بنطال جينز', date: '2024-07-27', status: 'Pending' },
                ]);
            };

            const connectToInstagram = async () => {
                setLoading(true);
                try {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    alert('Instagram connection feature coming soon! Backend integration ready.');
                } catch (error) {
                    alert('Instagram connection failed');
                } finally {
                    setLoading(false);
                }
            };

            const addProduct = () => {
                const name = prompt('Product name:');
                const nameEn = prompt('Product name (English):');
                const price = prompt('Product price (JOD):');
                const stock = prompt('Stock quantity:');
                
                if (name && price && stock) {
                    const newProduct = {
                        id: 'prod_' + Date.now(),
                        name,
                        name_en: nameEn,
                        price: parseFloat(price),
                        currency: 'JOD',
                        quantity: parseInt(stock),
                        stock: parseInt(stock)
                    };
                    setProducts([...products, newProduct]);
                    alert('Product added successfully!');
                }
            };

            const editProduct = (product) => {
                const name = prompt('Product name:', product.name);
                const price = prompt('Product price (JOD):', product.price);
                const stock = prompt('Stock quantity:', product.quantity || product.stock);
                
                if (name && price && stock) {
                    const updatedProducts = products.map(p => 
                        p.id === product.id 
                            ? { ...p, name, price: parseFloat(price), quantity: parseInt(stock), stock: parseInt(stock) }
                            : p
                    );
                    setProducts(updatedProducts);
                    alert('Product updated successfully!');
                }
            };

            const deleteProduct = (product) => {
                if (confirm(`Delete ${product.name}?`)) {
                    const updatedProducts = products.filter(p => p.id !== product.id);
                    setProducts(updatedProducts);
                    alert('Product deleted successfully!');
                }
            };

            const saveKnowledgeBase = () => {
                alert('Knowledge base saved successfully!');
            };

            const renderView = () => {
                switch (activeView) {
                    case 'Dashboard':
                        return React.createElement(DashboardView, {
                            isConnected,
                            connectToInstagram,
                            loading,
                            onRefresh: checkBackendConnection
                        });
                    case 'Knowledge Base':
                        return React.createElement(KnowledgeBaseView, {
                            knowledgeBase,
                            setKnowledgeBase,
                            onSave: saveKnowledgeBase
                        });
                    case 'Products':
                        return React.createElement(ProductsView, {
                            products,
                            onAdd: addProduct,
                            onEdit: editProduct,
                            onDelete: deleteProduct
                        });
                    case 'Orders':
                        return React.createElement(OrdersView, { orders });
                    default:
                        return React.createElement(DashboardView, {
                            isConnected,
                            connectToInstagram,
                            loading,
                            onRefresh: checkBackendConnection
                        });
                }
            };

            return React.createElement('div', { className: 'min-h-screen bg-gray-900 text-white font-sans flex' },
                React.createElement(Sidebar, { activeView, setActiveView }),
                React.createElement('main', { className: 'flex-1 p-4 sm:p-6 lg:p-8' }, renderView())
            );
        }

        const Sidebar = ({ activeView, setActiveView }) => {
            const navItems = [
                { name: 'Dashboard', icon: Home },
                { name: 'Knowledge Base', icon: BrainCircuit },
                { name: 'Products', icon: ShoppingBag },
                { name: 'Orders', icon: ListOrdered },
            ];

            return React.createElement('aside', { className: 'w-16 sm:w-64 bg-gray-800 p-2 sm:p-4 flex flex-col' },
                React.createElement('div', { className: 'flex items-center justify-center sm:justify-start mb-10' },
                    React.createElement(Bot, { className: 'h-8 w-8 text-cyan-400' }),
                    React.createElement('h1', { className: 'hidden sm:block text-2xl font-bold ml-2 text-white' }, 'InstaBot AI')
                ),
                React.createElement('nav', { className: 'flex flex-col space-y-2' },
                    navItems.map((item) =>
                        React.createElement('button', {
                            key: item.name,
                            onClick: () => setActiveView(item.name),
                            className: `flex items-center p-3 rounded-lg transition-colors duration-200 ${
                                activeView === item.name
                                    ? 'bg-cyan-500 text-white'
                                    : 'hover:bg-gray-700 text-gray-300'
                            }`
                        },
                            React.createElement(item.icon, { className: 'h-5 w-5 flex-shrink-0' }),
                            React.createElement('span', { className: 'hidden sm:block ml-4 font-medium' }, item.name)
                        )
                    )
                )
            );
        };

        const DashboardView = ({ isConnected, connectToInstagram, loading, onRefresh }) => {
            return React.createElement('div', {},
                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                    React.createElement('h2', { className: 'text-3xl font-bold text-white' }, 'Dashboard'),
                    React.createElement('button', {
                        onClick: onRefresh,
                        className: 'flex items-center px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors'
                    },
                        React.createElement(RefreshCw, { className: 'h-4 w-4 mr-2' }),
                        'Refresh'
                    )
                ),
                React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg shadow-lg' },
                    React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Welcome, Shop Owner!'),
                    React.createElement('p', { className: 'text-gray-400 mb-6' },
                        'This is your control center. Connect your Instagram account to get started.'
                    ),
                    React.createElement('div', { className: 'flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-6' },
                        React.createElement('button', {
                            onClick: connectToInstagram,
                            disabled: loading,
                            className: `${loading ? 'bg-gray-600' : 'bg-green-600 hover:bg-green-700'} text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 shadow-md flex items-center`
                        },
                            loading && React.createElement(RefreshCw, { className: 'h-4 w-4 mr-2 animate-spin' }),
                            loading ? 'Connecting...' : 'Connect to Instagram'
                        ),
                        React.createElement('div', { className: 'flex items-center' },
                            React.createElement('span', { className: 'mr-3 text-gray-300' }, 'Backend Status:'),
                            React.createElement('span', {
                                className: `font-semibold ${isConnected ? 'text-green-500' : 'text-red-500'}`
                            },
                                isConnected ? 'Connected ✅' : 'Disconnected ❌'
                            )
                        )
                    )
                )
            );
        };

        const KnowledgeBaseView = ({ knowledgeBase, setKnowledgeBase, onSave }) => {
            return React.createElement('div', {},
                React.createElement('h2', { className: 'text-3xl font-bold mb-6 text-white' }, 'Knowledge Base'),
                React.createElement('div', { className: 'bg-gray-800 p-6 rounded-lg shadow-lg' },
                    React.createElement('h3', { className: 'text-xl font-semibold mb-4' }, 'Teach Your AI'),
                    React.createElement('p', { className: 'text-gray-400 mb-6' },
                        'Provide all the necessary information about your business below. The AI will use this to answer customer questions about working hours, return policies, shipping info, etc.'
                    ),
                    React.createElement('textarea', {
                        value: knowledgeBase,
                        onChange: (e) => setKnowledgeBase(e.target.value),
                        className: 'w-full h-64 p-4 bg-gray-900 border border-gray-700 rounded-lg text-gray-300 focus:outline-none focus:ring-2 focus:ring-cyan-500',
                        placeholder: 'e.g., Our working hours are from 9 AM to 5 PM, Sunday to Thursday. We offer a 14-day return policy...'
                    }),
                    React.createElement('button', {
                        onClick: onSave,
                        className: 'mt-4 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 shadow-md flex items-center'
                    },
                        React.createElement(Save, { className: 'h-4 w-4 mr-2' }),
                        'Save Information'
                    )
                )
            );
        };

        const ProductsView = ({ products, onAdd, onEdit, onDelete }) => {
            return React.createElement('div', {},
                React.createElement('h2', { className: 'text-3xl font-bold mb-6 text-white' }, 'Product Catalog'),
                React.createElement('div', { className: 'flex justify-end mb-4' },
                    React.createElement('button', {
                        onClick: onAdd,
                        className: 'bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-200 shadow-md flex items-center'
                    },
                        React.createElement(Plus, { className: 'h-4 w-4 mr-2' }),
                        'Add New Product'
                    )
                ),
                React.createElement('div', { className: 'bg-gray-800 rounded-lg shadow-lg overflow-x-auto' },
                    React.createElement('table', { className: 'w-full text-left' },
                        React.createElement('thead', {},
                            React.createElement('tr', { className: 'bg-gray-700' },
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Product Name'),
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Price'),
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Stock'),
                                React.createElement('th', { className: 'p-4 font-semibold text-right' }, 'Actions')
                            )
                        ),
                        React.createElement('tbody', {},
                            products.length > 0 ? products.map((product) =>
                                React.createElement('tr', { key: product.id, className: 'border-b border-gray-700 last:border-b-0' },
                                    React.createElement('td', { className: 'p-4' },
                                        React.createElement('div', {},
                                            React.createElement('div', { className: 'font-medium' }, product.name),
                                            product.name_en && React.createElement('div', { className: 'text-sm text-gray-400' }, product.name_en)
                                        )
                                    ),
                                    React.createElement('td', { className: 'p-4' }, `${product.price} ${product.currency}`),
                                    React.createElement('td', { className: 'p-4' }, product.quantity || product.stock || 0),
                                    React.createElement('td', { className: 'p-4 flex justify-end space-x-2' },
                                        React.createElement('button', {
                                            onClick: () => onEdit(product),
                                            className: 'bg-yellow-500 hover:bg-yellow-600 text-white text-sm font-bold py-1 px-3 rounded-md transition-colors duration-200 flex items-center'
                                        },
                                            React.createElement(Edit, { className: 'h-3 w-3 mr-1' }),
                                            'Edit'
                                        ),
                                        React.createElement('button', {
                                            onClick: () => onDelete(product),
                                            className: 'bg-red-600 hover:bg-red-700 text-white text-sm font-bold py-1 px-3 rounded-md transition-colors duration-200 flex items-center'
                                        },
                                            React.createElement(Trash2, { className: 'h-3 w-3 mr-1' }),
                                            'Delete'
                                        )
                                    )
                                )
                            ) : React.createElement('tr', {},
                                React.createElement('td', { colSpan: '4', className: 'p-8 text-center text-gray-400' },
                                    'No products available. Add your first product!'
                                )
                            )
                        )
                    )
                )
            );
        };

        const OrdersView = ({ orders }) => {
            return React.createElement('div', {},
                React.createElement('h2', { className: 'text-3xl font-bold mb-6 text-white' }, 'Orders'),
                React.createElement('div', { className: 'bg-gray-800 rounded-lg shadow-lg overflow-x-auto' },
                    React.createElement('table', { className: 'w-full text-left' },
                        React.createElement('thead', {},
                            React.createElement('tr', { className: 'bg-gray-700' },
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Customer'),
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Product'),
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Date'),
                                React.createElement('th', { className: 'p-4 font-semibold' }, 'Status')
                            )
                        ),
                        React.createElement('tbody', {},
                            orders.length > 0 ? orders.map((order) =>
                                React.createElement('tr', { key: order.id, className: 'border-b border-gray-700 last:border-b-0' },
                                    React.createElement('td', { className: 'p-4' }, order.customer),
                                    React.createElement('td', { className: 'p-4' }, order.product),
                                    React.createElement('td', { className: 'p-4' }, order.date),
                                    React.createElement('td', { className: 'p-4' },
                                        React.createElement('span', {
                                            className: `px-2 py-1 text-xs font-semibold rounded-full ${
                                                order.status === 'Shipped' ? 'bg-green-500 text-green-900' : 'bg-yellow-500 text-yellow-900'
                                            }`
                                        }, order.status)
                                    )
                                )
                            ) : React.createElement('tr', {},
                                React.createElement('td', { colSpan: '4', className: 'p-8 text-center text-gray-400' },
                                    'No orders yet. Orders will appear here when customers make purchases.'
                                )
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html> 